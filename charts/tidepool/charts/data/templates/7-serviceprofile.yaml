{{ if .Values.global.linkerdsupport.enabled }}
apiVersion: linkerd.io/v1alpha2
kind: ServiceProfile
metadata:
  name: data.{{ .Release.Namespace }}.svc.cluster.local
  namespace: '{{ .Release.Namespace }}'
spec:
  routes:
  - condition:
      method: GET
      pathRegex: /v1/users/[^/]+/data_sources
    name: /v1/users/{id}/data_sources_get_data
  - condition:
      method: POST
      pathRegex: /v1/users/[^/]+/data_sources
    name: /v1/users/{id}/data_sources_post_data
  - condition:
      method: DELETE
      pathRegex: /v1/users/[^/]+/data_sources
    name: /v1/users/{id}/data_sources_delete_data
  - condition:
      method: GET
      pathRegex: /v1/users/[^/]+/data_sets
    name: /v1/users/{id}/data_sets_get_data
    timeout: 60s
  - condition:
      method: POST
      pathRegex: /v1/users/[^/]+/data_sets
    name: /v1/users/{id}/data_sets_post_data
    timeout: 60s
  - condition:
      method: GET
      pathRegex: /v1/users/[^/]+/datasets
    name: /v1/users/{id}/datasets_get_data
  - condition:
      method: POST
      pathRegex: /v1/users/[^/]+/datasets
    name: /v1/users/{id}/datasets_post_data
  - condition:
      method: GET
      pathRegex: /v1/data_sources/[^/]+
    name: /v1/data_sources/{id}_get_data
  - condition:
      method: PUT
      pathRegex: /v1/data_sources/[^/]+
    name: /v1/data_sources/{id}_put_data
  - condition:
      method: DELETE
      pathRegex: /v1/data_sources/[^/]+
    name: /v1/data_sources/{id}_delete_data
  - condition:
      method: DELETE
      pathRegex: /v1/users/[^/]+/data
    name: /v1/users/{id}/data_delete_data
  - condition:
      method: GET
      pathRegex: /v1/data_sets.*
    name: /v1/data_sets_get_data
    timeout: 60s
  - condition:
      method: POST
      pathRegex: /v1/data_sets.*
    name: /v1/data_sets_post_data
    timeout: 60s
  - condition:
      method: DELETE
      pathRegex: /v1/data_sets.*
    name: /v1/data_sets_delete_data
    timeout: 60s
  - condition:
      method: PUT
      pathRegex: /v1/data_sets.*
    name: /v1/data_sets_put_data
    timeout: 60s
  - condition:
      method: POST
      pathRegex: /v1/datasets.*
    name: /v1/datasets_post_data
    timeout: 30s
  - condition:
      method: PUT
      pathRegex: /v1/datasets.*
    name: /v1/datasets_put_data
    timeout: 30s
  - condition:
      method: DELETE
      pathRegex: /v1/datasets.*
    name: /v1/datasets_delete_data
    timeout: 30s
  - condition:
      method: GET
      pathRegex: /v1/time.*
    name: /v1/time_get_data
{{- end }}
